# AI角色扮演网站 - 运行说明文档

## 环境要求

### 系统要求
- **操作系统**: macOS / Linux / Windows (WSL2)
- **Docker**: 20.10+ 
- **Docker Compose**: 2.0+
- **内存**: 8GB+ (推荐16GB)
- **存储**: 10GB+ 可用空间

### 网络要求
- 稳定的互联网连接（用于访问DeepSeek-V3 API）
- 开放端口：3000, 8080, 3306, 6379, 5672, 15672, 9000, 9001

## 快速开始

### 1. 环境准备

```bash
# 克隆项目
git clone https://github.com/DROWNING2003/memo-shop.git
cd memo-shop

# 复制环境配置文件
cp .env.example .env
```

### 2. 配置环境变量

编辑 `.env` 文件，配置必要的环境变量：

```bash
# DeepSeek-V3 API密钥（必需）
OPENAI_API_KEY=your_deepseek_api_key_here

# 数据库配置（可选，默认值通常可用）
DB_HOST=mysql
DB_PORT=3306
DB_NAME=memo_shop
DB_USER=memo_shop_user
DB_PASSWORD=memo_shop_password

# Redis配置
REDIS_HOST=redis
REDIS_PORT=6379

# MinIO配置
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
```

### 3. 启动服务

#### 方式一：使用快速启动脚本（推荐）

```bash
# 赋予执行权限
chmod +x scripts/quick-start.sh

# 运行快速启动
./scripts/quick-start.sh
```

选择启动模式：
- **选项1**: 开发环境（仅基础服务）
- **选项2**: 完整环境（所有服务）

#### 方式二：手动启动

```bash
# 启动所有服务
docker-compose up -d

# 或者仅启动开发环境
docker-compose -f docker-compose.dev.yml up -d
```

### 4. 验证服务状态

```bash
# 检查服务健康状态
docker-compose ps

# 查看服务日志
docker-compose logs -f
```

## 服务访问地址

服务启动后，可以通过以下地址访问：

| 服务 | 访问地址 | 说明 |
|------|----------|------|
| 前端应用 | http://localhost:3000 | 用户界面 |
| 后端API | http://localhost:8080 | REST API服务 |
| API文档 | http://localhost:8080/swagger | Swagger UI |
| MySQL数据库 | localhost:3306 | 数据库管理 |
| Redis缓存 | localhost:6379 | 缓存服务 |
| RabbitMQ管理 | http://localhost:15672 | 消息队列管理 |
| MinIO控制台 | http://localhost:9001 | 对象存储管理 |

**默认登录信息：**
- RabbitMQ管理界面：guest/guest
- MinIO控制台：minioadmin/minioadmin123

## 开发模式运行

### 前端开发

```bash
cd fronted

# 安装依赖
npm install  # 或 pnpm install

# 启动开发服务器
npm run dev
```

### 后端开发

```bash
cd backend

# 安装Go依赖
go mod tidy

# 启动开发服务器
go run main.go
```

### AI代理开发

```bash
cd agent

# 安装Python依赖
pip install -r requirements.txt

# 启动AI代理
python main.py
```

## 数据初始化

### 数据库初始化

项目启动时会自动执行数据库初始化脚本：

```sql
-- 查看初始化脚本
cat init-scripts/01-init.sql
```

### 测试数据

系统会自动创建一些测试角色和用户数据：

- **预设角色**: 大大怪将军、小小怪下士等
- **测试用户**: 可通过注册功能创建新用户

## 功能测试

### 1. 用户注册登录

访问 http://localhost:3000 进行用户注册和登录测试。

### 2. 角色对话测试

1. 登录后进入角色列表页面
2. 选择喜欢的角色（如"大大怪将军"）
3. 发送文字或语音消息
4. 查看AI角色的回复

### 3. 语音功能测试

1. 在聊天界面点击麦克风图标
2. 录制语音消息
3. 等待AI语音回复

## 故障排除

### 常见问题

#### 1. 端口冲突

如果端口被占用，可以修改 `docker-compose.yml` 中的端口映射：

```yaml
ports:
  - "3001:3000"  # 修改前端端口
  - "8081:8080"  # 修改后端端口
```

#### 2. 内存不足

如果遇到内存不足问题：

```bash
# 增加Docker内存限制
# 或者在docker-compose.yml中限制服务内存
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 1G
```

#### 3. API密钥错误

确保 `.env` 文件中的 `OPENAI_API_KEY` 配置正确。

### 日志查看

```bash
# 查看所有服务日志
docker-compose logs

# 查看特定服务日志
docker-compose logs backend
docker-compose logs agent
docker-compose logs frontend

# 实时查看日志
docker-compose logs -f backend
```

### 服务重启

```bash
# 重启单个服务
docker-compose restart backend

# 重启所有服务
docker-compose restart

# 完全重新构建
docker-compose down
docker-compose up -d --build
```

## 生产部署

### 环境配置

生产环境需要配置：

1. **域名和SSL证书**
2. **数据库备份策略**
3. **监控和告警系统**
4. **日志收集和分析**

### 安全配置

- 修改默认密码
- 配置防火墙规则
- 启用HTTPS
- 设置访问限制

## 维护命令

### 数据库备份

```bash
# 备份数据库
docker exec memo-shop-mysql mysqldump -u root -p memo_shop > backup.sql

# 恢复数据库
docker exec -i memo-shop-mysql mysql -u root -p memo_shop < backup.sql
```

### 清理资源

```bash
# 停止并删除容器
docker-compose down

# 清理所有Docker资源
docker system prune -a

# 清理特定卷
docker volume rm memo-shop_mysql_data
```

## 技术支持

如果遇到问题，请：

1. 查看项目README.md文档
2. 检查服务日志输出
3. 在GitHub Issues中提交问题
4. 联系开发团队

这个运行说明文档提供了完整的项目部署和使用指南，确保用户能够顺利运行AI角色扮演网站。
